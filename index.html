<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>WebSockets</title>
		<style>
		#log{height:300px; width:60%; border:1px solid grey;margin:10px auto;
			overflow-y:auto; overflow-x:hidden;}
		#in_ctrl{display:flex; justify-content: center;}
		</style>
	</head>
	<body>

		<div id="log"></div>

		<div id="in_ctrl">
			<input type="text" placeholder="Your message here" id="text">
			<button>Send</button>
		</div>


		<script>
			//var name = prompt("what is your name fella?");
			var name = "tester";
			//var sock = new WebSocket("ws://localhost:5001");
			//var HOST = location.origin.replace(/^http/, 'ws')//wont work on a separate server
			//var sock = new WebSocket(HOST);
			var sock = new WebSocket("wss://cryptic-ocean-42125.herokuapp.com");

			sock.onopen = function(){
				sock.send(JSON.stringify({
					type:"name",
					data: name
				}));
			}

			var log = document.getElementById('log');

			sock.onmessage = function(event){
				console.log(event);
				var m_json = JSON.parse(event.data);

				log.innerHTML += m_json.name + ": " +  m_json.data + "</br>";

			}

			document.onkeypress = function(e)
			{
					var key = e.which || e.keyCode;
					if (key === 13) { // 13 is enter
						// code for enter
						process_text();
					}
			}//end onkeypress

			document.querySelector('button').onclick = function(){
				process_text();
			};//end onclick

			var process_text = function()
			{
				var input_el = document.getElementById('text');
				var text = input_el.value;
				log.innerHTML += "you (" + name + "): " + text + "</br>";
				//sock.send(text);
				sock.send(JSON.stringify({
					type:"message",
					data: text
				}));

				input_el.value = "";
			}//end process_text
		</script>
	</body>
</html>
